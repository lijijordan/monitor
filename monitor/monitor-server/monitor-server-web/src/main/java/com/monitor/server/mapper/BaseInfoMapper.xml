<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC   
    "-//mybatis.org//DTD Mapper 3.0//EN"  
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BaseInfoMapper">

	<!-- 用户 -->
	<resultMap id="UserInfoMap" type="UserInfo">
		<id property="id" column="id" />
		<result property="account" column="account" />
		<result property="nickname" column="nickname" />
		<result property="password" column="password" />
		<result property="cellphone" column="cellphone" />
		<result property="telephone" column="telephone" />
		<result property="email" column="email" />
		<result property="sex" column="sex" />
		<result property="age" column="age" />
		<result property="headimgurl" column="headimgurl" />
		<result property="country" column="country" />
		<result property="province" column="province" />
		<result property="city" column="city" />
		<result property="privilege" column="privilege" />
		<result property="unionid" column="unionid" />
	</resultMap>

	<select id="getUserByAccount" parameterType="String" resultMap="UserInfoMap">
		SELECT *
		FROM user
		WHERE account = #{account}
	</select>

	<insert id="createUser" parameterType="UserInfo"
		useGeneratedKeys="true" keyProperty="id">
		INSERT INTO user
		(account,nickname,password,cellphone,telephone,email,sex,age,province,city,country,headimgurl,privilege,unionid)
		VALUES
		(#{account},#{nickname},#{password},#{cellphone},#{telephone},#{email},#{sex},#{age},#{province},#{city},#{country},#{headimgurl},#{privilege}),#{unionid})
	</insert>

	<delete id="deleteUser" parameterType="int">
		DELETE from user
		WHERE
		user_id = #{id}
	</delete>

	<update id="updateUser" parameterType="UserInfo">
		UPDATE user SET
		user_name =
		#{name},
		user_sex = #{sex},
		user_email = #{email},
		user_tel =
		#{telNum},
		user_age = #{age},
		user_pwd = #{pwd},
		user_wechat =
		#{webChat},
		aquariums_length = #{aquariumsLength},
		aquariums_width =
		#{aquariumsWidth},
		aquariums_height = #{aquariumsHeigth},
		aquariums_type = #{aquariumsType},
		aquariums_age = #{aquariumsAge}
		WHERE user_id = #{id}
	</update>

	<select id="countAllUserNum" resultType="Integer">
		SELECT count(u.user_id)
		FROM user u
	</select>

	<select id="selectAllUser" resultMap="UserInfoMap">
		SELECT *
		FROM user
	</select>

	<!-- 鱼缸 -->
	<resultMap id="FishTankMap" type="FishTankInfo">
		<id property="id" column="id" />
		<result property="length" column="length" />
		<result property="width" column="width" />
		<result property="height" column="height" />
		<result property="volume" column="volume" />
		<result property="type" column="type" />
		<association property="userInfo" resultMap="UserInfoMap" />
	</resultMap>

	<insert id="createFishTank" parameterType="FishTankInfo"
		useGeneratedKeys="true" keyProperty="id">
		INSERT INTO fishtank
		(length,width,height,volume,type,userid)
		VALUES
		(#{length},#{width},#{height},#{volume},#{type},#{userInfo.id})
	</insert>

	<!-- 网络 -->
	<resultMap id="NetworkMap" type="NetworkInfo">
		<id property="id" column="id" />
		<result property="ssid" column="ssid" />
		<result property="password" column="password" />
		<association property="userInfo" resultMap="UserInfoMap" />
	</resultMap>

	<insert id="createNetwork" parameterType="NetworkInfo"
		useGeneratedKeys="true" keyProperty="id">
		INSERT INTO network
		(ssid,password,userid)
		VALUES
		(#{ssid},#{password},#{userInfo.id})
	</insert>

	<!-- 设备 -->
	<resultMap id="DevMap" type="com.monitor.common.vo.DeviceVo">
		<id property="id" column="id" />
		<result property="alias" column="alias" />
		<result property="type" column="type" />
		<result property="remark" column="remark" />
		<result property="sn" column="sn" />
		<result property="registtime" column="registtime" />
		<result property="status" column="status" />
	</resultMap>

	<resultMap id="UserDevMap" type="UserDevInfo">
		<id property="id" column="id" />
		<result property="account" column="account" />
		<result property="sn" column="sn" />
	</resultMap>

	<insert id="createUserDevLink" parameterType="UserDevInfo"
		useGeneratedKeys="true" keyProperty="id">
		INSERT INTO user_dev
		(account,sn)
		VALUES
		(#{account},#{sn})
	</insert>

	<select id="getDevSNByUserAccount" parameterType="String"
		resultMap="String">
		SELECT sn
		FROM user_dev
		WHERE account = #{account}
	</select>


	<!-- 老代码 -->
	<resultMap id="EquInfoMap" type="EquInfo">
		<id property="id" column="fish_equ_id" />
		<result property="sn" column="fish_equ_sn" />
		<result property="ssid" column="fish_equ_ssid" />
		<result property="pwd" column="fish_equ_pwd" />
		<association property="userInfo" resultMap="UserInfoMap" />
	</resultMap>

	<resultMap id="AlarmInfoMap" type="AlarmInfo">
		<id property="id" column="alarm_id" />
		<result property="sensorType" column="alarm_devtype" />
		<result property="currentVal" column="alarm_devcurrentval" />
		<result property="threshold" column="alarm_devthreshold" />
		<result property="advice" column="alarm_advice" />
		<result property="createTime" column="alarm_time" />
		<association property="userInfo" resultMap="UserInfoMap" />
		<association property="equInfo" resultMap="EquInfoMap" />
	</resultMap>

	<resultMap id="OptInfoMap" type="OptInfo">
		<id property="id" column="opt_info_id" />
		<result property="optType" column="opt_info_type" />
		<result property="optObject" column="opt_info_obj" />
		<result property="result" column="opt_info_result" />
		<result property="createTime" column="opt_info_time" />
		<association property="userInfo" resultMap="UserInfoMap" />
		<association property="equInfo" resultMap="EquInfoMap" />
	</resultMap>

	<select id="getEquById" parameterType="int" resultMap="EquInfoMap">
		SELECT *
		FROM fish_equ_info f, user u
		WHERE f.user_id = u.user_id AND
		f.fish_equ_id = #{id}
	</select>

	<select id="countAllEquNum" resultType="Integer">
		SELECT
		count(f.fish_equ_id)
		FROM fish_equ_info f
	</select>

	<select id="selectAllEqus" resultMap="EquInfoMap">
		SELECT *
		FROM fish_equ_info
		f, user u
		WHERE f.user_id = u.user_id
	</select>

	<insert id="createEqu" parameterType="EquInfo" useGeneratedKeys="true"
		keyProperty="id">
		INSERT INTO fish_equ_info
		(fish_equ_sn,fish_equ_ssid,fish_equ_pwd,user_id)
		VALUES
		(#{sn},#{ssid},#{pwd},#{userInfo.id})
	</insert>

	<update id="updateEqu" parameterType="EquInfo">
		UPDATE fish_equ_info SET
		fish_equ_sn = #{sn},
		fish_equ_ssid = #{ssid},
		fish_equ_pwd = #{pwd},
		user_id = #{userInfo.id}
		WHERE fish_equ_id = #{id}
	</update>

	<delete id="deleteEqu" parameterType="int">
		DELETE FROM fish_equ_info
		WHERE
		fish_equ_id = #{id}
	</delete>

	<select id="getAlarmById" parameterType="int" resultMap="AlarmInfoMap">
		SELECT *
		FROM alarm_info a
		WHERE a.alarm_id = #{id}
	</select>

	<select id="getAlarmsByUserID" parameterType="int" resultMap="AlarmInfoMap">
		SELECT *
		FROM alarm_info a
		WHERE a.user_id = #{id}
	</select>

	<insert id="createAlarm" parameterType="AlarmInfo"
		useGeneratedKeys="true" keyProperty="id">
		INSERT INTO alarm_info
		(alarm_time,alarm_devtype,alarm_devcurrentval,alarm_devthreshold,alarm_advice,user_id,fish_equ_id)
		VALUES
		(#{createTime},#{sensorType},#{currentVal},#{threshold},#{advice},#{userInfo.id},#{equInfo.id})
	</insert>

	<update id="updateAlarm" parameterType="AlarmInfo">
		UPDATE alarm_info SET
		alarm_time = #{createTime},
		alarm_devtype = #{sensorType},
		alarm_devcurrentval = #{currentVal},
		alarm_devthreshold = #{threshold},
		alarm_advice = #{advice},
		user_id = #{userInfo.id},
		fish_equ_id =
		#{equInfo.id}
		WHERE alarm_id = #{id}
	</update>

	<delete id="deleteAlarm" parameterType="int">
		DELETE FROM alarm_info
		WHERE
		alarm_id = #{id}
	</delete>

	<select id="getOptInfoById" parameterType="int" resultMap="OptInfoMap">
		SELECT *
		FROM opt_info o
		WHERE o.opt_info_id = #{id}
	</select>

	<select id="selectOptInfosByUserID" parameterType="int"
		resultMap="OptInfoMap">
		SELECT *
		FROM opt_info o
		WHERE o.user_id = #{id}
	</select>

	<insert id="createOptInfo" parameterType="OptInfo"
		useGeneratedKeys="true" keyProperty="id">
		INSERT INTO opt_info
		(opt_info_time,opt_info_type,opt_info_obj,opt_info_result,user_id,fish_equ_id)
		VALUES
		(#{createTime},#{optType},#{optObject},#{result},#{userInfo.id})
	</insert>

</mapper>  

